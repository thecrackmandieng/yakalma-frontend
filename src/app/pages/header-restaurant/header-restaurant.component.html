<!-- header.component.html -->
<header class="fixed top-0 left-0 w-full z-50 bg-[#4169E1] text-white px-6 py-2 flex justify-between items-center shadow-md">
  <!-- Logo -->
  <div class="flex items-center">
    <a routerLink="/restaurants" aria-label="Retour à la page des restaurants">
      <h1 class="text-2xl font-serif !no-underline text-white font-bold">Yakalma</h1>
    </a>
  </div>

  <!-- Bouton Burger (mobile) -->
  <button
    class="lg:hidden text-white !text-2xl focus:outline-none"
    (click)="mobileMenuOpen = !mobileMenuOpen"
    aria-label="Menu mobile"
  >
    <i class="fas fa-bars"></i>
  </button>

  <!-- Navigation (desktop) -->
  <nav class="hidden lg:flex space-x-6" role="navigation" aria-label="Menu principal">
    <a
      routerLink="/restaurant/dashboard"
      routerLinkActive="text-blue-400 font-bold border-b-2 !border-blue-400 pb-1"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
    >
      Accueil
    </a>

    <a
      routerLink="/restaurant/menu-management"
      routerLinkActive="text-blue-400 font-bold border-b-2 border-blue-400 pb-1"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
    >
      Commande
    </a>

    <a
      routerLink="/restaurant/menu"
      routerLinkActive="text-blue-400 font-bold border-b-2 border-blue-400 pb-1"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
    >
      Menu
    </a>

    <a
      routerLink="/pages"
      routerLinkActive="text-blue-400 font-bold border-b-2 border-blue-400 pb-1"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
    >
      Pages
    </a>
  </nav>


  <!-- Profil -->
  <div
    *ngIf="isRestaurant"
    class="relative"
    (click)="toggleDropdown()"
    tabindex="0"
    role="button"
    aria-haspopup="true"
    [attr.aria-expanded]="dropdownOpen"
  >
    <div class="flex items-center gap-2 cursor-pointer">
      <img src="assets/chefn.webp" alt="Avatar utilisateur" class="w-8 h-8 rounded-full object-cover" />
      <span class="hidden sm:inline">Mon Compte</span>
      <span class="text-xs">&#9662;</span>
    </div>

    <!-- Dropdown -->
    <div
      *ngIf="dropdownOpen"
      class="absolute right-0 mt-2 w-52 bg-white text-gray-800 rounded-lg shadow-lg z-50"
      role="menu"
    >
      <a
        role="menuitem"
        (click)="goToProfile()"
        class="block px-6 py-2 hover:bg-[#4169E1] !text-gray-800 hover:!text-white !no-underline transition"
      ><i class="fas fa-user-circle text-[#bbb] hover:!bg-white text-xl"></i> Profil</a>
      <a
        role="menuitem"
        (click)="changePassword()"
        class="block px-2 py-2 hover:bg-[#4169E1] text-left !text-gray-800 hover:!text-white !no-underline transition"
      ><i class="fas fa-key text-[#bbb] text-xl"></i> Changer mot de passe</a>
      <a
        role="menuitem"
        (click)="logout()"
        class="block px-4 py-2 hover:bg-red-500 !text-gray-800 hover:!text-white !no-underline transition"
      ><i class="fas fa-sign-out-alt text-red-300 text-xl"></i> Déconnexion</a>
    </div>
  </div>

  <!-- Menu Mobile -->
  <div *ngIf="mobileMenuOpen" class="absolute top-full left-0 w-full bg-[#4169E1] flex flex-col items-start px-6 py-4 space-y-3 lg:hidden z-40">
    <a
      routerLink="/restaurant/dashboard"
      routerLinkActive="text-blue-400 font-bold border-l-4 border-blue-400 pl-2"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
      (click)="mobileMenuOpen=false"
    >
      Accueil
    </a>

    <a
      routerLink="/restaurant/menu-management"
      routerLinkActive="text-blue-400 font-bold border-l-4 border-blue-400 pl-2"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
      (click)="mobileMenuOpen=false"
    >
      Commande
    </a>

    <a
      routerLink="/restaurant/menu"
      routerLinkActive="text-blue-400 font-bold border-l-4 border-blue-400 pl-2"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
      (click)="mobileMenuOpen=false"
    >
      Menu
    </a>

    <a
      routerLink="/pages"
      routerLinkActive="text-blue-400 font-bold border-l-4 border-blue-400 pl-2"
      [routerLinkActiveOptions]="{ exact: true }"
      *ngIf="isRestaurant"
      class="hover:!text-blue-300 !text-white !no-underline transition"
      (click)="mobileMenuOpen=false"
    >
      Pages
    </a>
  </div>
</header>

<!-- =========================================== -->
  <!-- Backdrop générique -->
<!-- Modal Profil -->
<div
  *ngIf="showProfileModal"
  class="fixed inset-0 bg-black/60 flex items-center justify-center z-[9999]"
  role="dialog"
  aria-modal="true"
  aria-labelledby="profileModalTitle"
  (click)="closeProfileModal()"
>
  <div
    class="bg-white text-gray-800 rounded-xl shadow-lg w-[600px] max-w-[95%] max-h-[90vh] overflow-y-auto p-6"
    (click)="$event.stopPropagation()"
  >
    <!-- Titre -->
    <h2 id="profileModalTitle" class="text-2xl font-bold text-center mb-6">
      Mon Profil
    </h2>

    <form
      (submit)="saveProfile(); $event.preventDefault()"
      enctype="multipart/form-data"
      novalidate
      class="space-y-6"
    >
      <!-- Champs texte (2 par ligne en desktop, 1 en mobile) -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="firstName" class="block text-sm font-medium text-gray-700">Prénom</label>
          <input
            id="firstName"
            type="text"
            [(ngModel)]="firstName"
            name="firstName"
            required
            autocomplete="given-name"
            class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"
          />
        </div>
        <div>
          <label for="lastName" class="block text-sm font-medium text-gray-700">Nom</label>
          <input
            id="lastName"
            type="text"
            [(ngModel)]="lastName"
            name="lastName"
            required
            autocomplete="family-name"
            class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"
          />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
          <input
            id="email"
            type="email"
            [(ngModel)]="email"
            name="email"
            required
            autocomplete="email"
            class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"
          />
        </div>
        <div>
          <label for="phone" class="block text-sm font-medium text-gray-700">Téléphone</label>
          <input
            id="phone"
            type="tel"
            [(ngModel)]="phone"
            name="phone"
            required
            autocomplete="tel"
            pattern="^[+0-9\s\-]+$"
            class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50"
          />
        </div>
      </div>

      <hr class="my-4" />

      <!-- Uploads -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="permis" class="block text-sm font-medium text-gray-700">Permis</label>
          <input
            id="permis"
            type="file"
            (change)="onFileChange($event, 'permis')"
            accept=".pdf,.jpg,.jpeg,.png"
            class="mt-2 block w-full text-sm text-gray-600 rounded-md border border-gray-300 px-3 py-2 shadow-sm cursor-pointer"
          />
          <div *ngIf="uploadedFilesUrl['permisUrl']" class="mt-1">
            <a [href]="uploadedFilesUrl['permisUrl']" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">Voir le document actuel</a>
          </div>
        </div>

        <div>
          <label for="certificat" class="block text-sm font-medium text-gray-700">Certificat</label>
          <input
            id="certificat"
            type="file"
            (change)="onFileChange($event, 'certificat')"
            accept=".pdf,.jpg,.jpeg,.png"
            class="mt-2 block w-full text-sm text-gray-600 rounded-md border border-gray-300 px-3 py-2 shadow-sm cursor-pointer"
          />
          <div *ngIf="uploadedFilesUrl['certificatUrl']" class="mt-1">
            <a [href]="uploadedFilesUrl['certificatUrl']" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">Voir le document actuel</a>
          </div>
        </div>

        <div>
          <label for="autresDocs" class="block text-sm font-medium text-gray-700">Autres Documents</label>
          <input
            id="autresDocs"
            type="file"
            (change)="onFileChange($event, 'autresDocs')"
            accept=".pdf,.jpg,.jpeg,.png"
            class="mt-2 block w-full text-sm text-gray-600 rounded-md border border-gray-300 px-3 py-2 shadow-sm cursor-pointer"
          />
          <div *ngIf="uploadedFilesUrl['autresDocsUrl']" class="mt-1">
            <a [href]="uploadedFilesUrl['autresDocsUrl']" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">Voir le document actuel</a>
          </div>
        </div>

        <div>
          <label for="idCardCopy" class="block text-sm font-medium text-gray-700">Copie Carte d’Identité</label>
          <input
            id="idCardCopy"
            type="file"
            (change)="onFileChange($event, 'idCardCopy')"
            accept=".pdf,.jpg,.jpeg,.png"
            class="mt-2 block w-full text-sm text-gray-600 rounded-md border border-gray-300 px-3 py-2 shadow-sm cursor-pointer"
          />
          <div *ngIf="uploadedFilesUrl['idCardCopyUrl']" class="mt-1">
            <a [href]="uploadedFilesUrl['idCardCopyUrl']" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline">Voir le document actuel</a>
          </div>
        </div>

        <div>
          <label for="photo" class="block text-sm font-medium text-gray-700">Photo</label>
          <input
            id="photo"
            type="file"
            (change)="onFileChange($event, 'photo')"
            accept=".jpg,.jpeg,.png"
            class="mt-2 block w-full text-sm text-gray-600 rounded-md border border-gray-300 px-3 py-2 shadow-sm cursor-pointer"
          />
          <div *ngIf="uploadedFilesUrl['photoUrl']" class="mt-2">
            <img [src]="uploadedFilesUrl['photoUrl']" alt="" class="w-24 h-24 object-cover rounded-md" />
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-between space-x-4 mt-6">
        <button
          type="submit"
          class="bg-[#5371ff] hover:bg-[#415ad8] text-white font-semibold px-4 py-2 rounded-md shadow"
        >
          Enregistrer
        </button>
        <button
          type="button"
          (click)="closeProfileModal()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-4 py-2 rounded-md shadow"
        >
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>


<!-- ✅ Modal Succès -->
<div *ngIf="showSuccessModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[9999]" (click)="closeSuccessModal()">
  <div class="bg-white p-6 rounded-lg shadow-lg w-[90%] max-w-md text-center border-l-4 border-green-500" (click)="$event.stopPropagation()">
    <h2 class="text-xl font-bold mb-3 text-green-600">Succès</h2>
    <p class="mb-4">{{ modalMessage }}</p>
    <button (click)="closeSuccessModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition">Fermer</button>
  </div>
</div>

<!-- ✅ Modal Erreur -->
<div *ngIf="showErrorModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-[9999]" (click)="closeErrorModal()">
  <div class="bg-white p-6 rounded-lg shadow-lg w-[90%] max-w-md text-center border-l-4 border-red-500" (click)="$event.stopPropagation()">
    <h2 class="text-xl font-bold mb-3 text-red-600">Erreur</h2>
    <p class="mb-4">{{ modalMessage }}</p>
    <button (click)="closeErrorModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition">Fermer</button>
  </div>
</div>

<!-- ================================== -->
<!-- Modal Changer Mot de Passe -->
<!-- Modal Changer Mot de Passe -->
<div
  *ngIf="showPasswordModal"
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
  role="dialog"
  aria-modal="true"
  aria-labelledby="passwordModalTitle"
  (click)="closePasswordModal()"
>
  <div
    class="bg-white rounded-lg shadow-lg w-full max-w-md p-6 relative"
    (click)="$event.stopPropagation()"
  >
    <!-- Titre -->
    <h2 id="passwordModalTitle" class="text-2xl font-bold text-center mb-6">
      Changer le mot de passe
    </h2>

    <!-- Formulaire -->
    <form
      (submit)="submitPasswordChange(); $event.preventDefault()"
      novalidate
      class="space-y-4"
    >
      <!-- Mot de passe actuel -->
      <div>
        <label for="currentPassword" class="block text-sm font-medium text-gray-700"
          >Mot de passe actuel</label
        >
        <input
          id="currentPassword"
          type="password"
          [(ngModel)]="currentPassword"
          name="currentPassword"
          required
          autocomplete="current-password"
          class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-[#5371ff] focus:ring focus:ring-[#5371ff] focus:ring-opacity-50"
        />
      </div>

      <!-- Nouveau mot de passe -->
      <div>
        <label for="newPassword" class="block text-sm font-medium text-gray-700"
          >Nouveau mot de passe</label
        >
        <input
          id="newPassword"
          type="password"
          [(ngModel)]="newPassword"
          name="newPassword"
          required
          autocomplete="new-password"
          class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-[#5371ff] focus:ring focus:ring-[#5371ff] focus:ring-opacity-50"
        />
      </div>

      <!-- Confirmation -->
      <div>
        <label for="confirmPassword" class="block text-sm font-medium text-gray-700"
          >Confirmer le mot de passe</label
        >
        <input
          id="confirmPassword"
          type="password"
          [(ngModel)]="confirmPassword"
          name="confirmPassword"
          required
          autocomplete="new-password"
          class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-[#5371ff] focus:ring focus:ring-[#5371ff] focus:ring-opacity-50"
        />
      </div>

      <!-- Messages d’erreur / succès -->
      <div *ngIf="passwordError" class="text-red-600 text-sm" role="alert">
        {{ passwordError }}
      </div>
      <div *ngIf="passwordSuccess" class="text-green-600 text-sm" role="alert">
        {{ passwordSuccess }}
      </div>

      <!-- Actions -->
      <div class="flex justify-between mt-6">
        <button
          type="submit"
          class="bg-[#5371ff] hover:bg-[#415ad8] text-white font-semibold px-4 py-2 rounded-md shadow"
        >
          Modifier
        </button>
        <button
          type="button"
          (click)="closePasswordModal()"
          class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold px-4 py-2 rounded-md shadow"
        >
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>
