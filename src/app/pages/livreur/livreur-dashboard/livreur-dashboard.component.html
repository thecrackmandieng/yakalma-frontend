<app-header-livreur></app-header-livreur>

<div class="order-list">
  <h1>Liste des Commandes Livrées</h1>

  <div class="order-grid">
    <div class="order-card" *ngFor="let order of orders">

      <!-- ─── Image + actions ─────────────────────────────── -->
      <div class="order-image" [class.disabled]="order.status === 'en_cours'">
        <img [src]="order.image" alt="Image commande" />

        <div class="order-actions">
          <!-- Bouton Accepter (visible tant que status = 'livre') -->
          <button
            class="accept-button"
            *ngIf="order.status === 'livre'"
            (click)="acceptOrder(order)"
          >
            Accepter
          </button>

          <!-- Bouton Localisation (désactivé si status = 'en_cours') -->
          <button
            class="map-icon-button"
            title="Voir la localisation"
            (click)="showMap(order)"
            [disabled]="order.status === 'en_cours'"
          >
            <i class="fas fa-location-dot"></i>
          </button>
        </div>
      </div>

      <!-- ─── Détails ─────────────────────────────────────── -->
<div class="order-details">
  <h2>Commande #{{ order._id?.slice(0, 6) }}...</h2>
  <p><strong>Client :</strong> {{ order.customerName }}</p>
  <p><strong>Adresse :</strong> {{ order.address }}</p>
  <p><strong>Contact :</strong> {{ order.contact }}</p>

  <!-- NOUVEAU : Infos restaurant -->
  <p><strong>Restaurant :</strong> {{ order.restaurantName || 'N/A' }}</p>
  <p><strong>Téléphone restaurant :</strong> {{ order.restaurantPhone || 'N/A' }}</p>
  <p><strong>Adresse restaurant :</strong> {{ order.restaurantAddress || 'N/A' }}</p>

  <p><strong>Statut :</strong> {{ order.status }}</p>

  <p><strong>Articles :</strong></p>
  <ul>
    <li *ngFor="let item of order.items">
      {{ item.name }} – {{ item.quantity }}
    </li>
  </ul>
</div>

    </div>
  </div>
</div>

<!-- ─── Modal Google Map avec Navigation ─────────────────────────────────── -->
<div *ngIf="selectedOrder" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="navigation-header">
      <h3>Navigation vers le client</h3>
      <button class="close-btn" (click)="closeModal()">×</button>
    </div>

    <!-- Informations de route -->
    <div class="route-info" *ngIf="selectedOrder.routeInfo">
      <div class="info-item">
        <i class="fas fa-route"></i>
        <span>Distance: {{ selectedOrder.routeInfo.distance }}</span>
      </div>
      <div class="info-item">
        <i class="fas fa-clock"></i>
        <span>Temps estimé: {{ selectedOrder.routeInfo.duration }}</span>
      </div>
    </div>

    <!-- Carte OpenStreetMap -->
    <div id="map-container" style="height: 400px; width: 100%; border: 1px solid #ccc; border-radius: 8px;">
      <div *ngIf="!selectedOrder" style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
        <i class="fas fa-map-marked-alt" style="font-size: 2rem; margin-right: 10px;"></i>
        <span>Carte de navigation</span>
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="navigation-actions">
      <button class="btn-start-navigation" (click)="startNavigation(selectedOrder)">
        <i class="fas fa-play"></i>
        Démarrer la navigation
      </button>
      <button class="btn-close" (click)="closeModal()">
        <i class="fas fa-times"></i>
        Fermer
      </button>
    </div>

    <!-- Indicateur de chargement -->
    <div class="loading-indicator" *ngIf="isLoadingLocation">
      <i class="fas fa-spinner fa-spin"></i>
      <span>Chargement de votre position...</span>
    </div>

    <!-- Erreur de géolocalisation -->
    <div class="error-message" *ngIf="locationError">
      <i class="fas fa-exclamation-triangle"></i>
      <span>{{ locationError }}</span>
    </div>
  </div>
</div>

<app-footer></app-footer>
