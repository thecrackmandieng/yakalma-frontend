<app-header></app-header>
<app-sidebar></app-sidebar>

<div class="dashboard-container px-2 md:px-8 py-6 bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen font-serif">
  <!-- Titre du Dashboard -->
  <div class="mb-8 text-center">
    <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Tableau de Bord Administrateur</h1>
    <p class="text-gray-600 text-lg">Surveillez les performances et gérez les utilisateurs de Yakalma</p>
  </div>

  <!-- Cartes statistiques -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
    <!-- Skeleton Loading -->
    <ng-container *ngIf="isLoadingCards">
      <div class="bg-gray-200 rounded-xl shadow-lg p-8 flex flex-col items-center justify-center animate-pulse" *ngFor="let i of [1,2,3,4,5]">
        <div class="w-16 h-16 bg-gray-300 rounded-full mb-3"></div>
        <div class="w-24 h-4 bg-gray-300 rounded mb-2"></div>
        <div class="w-16 h-6 bg-gray-300 rounded"></div>
      </div>
    </ng-container>

    <!-- Cartes réelles -->
    <ng-container *ngIf="!isLoadingCards">
      <div class="bg-gradient-to-r from-[#5371FF] to-[#415ad8] rounded-xl shadow-lg p-8 flex flex-col items-center justify-center transform transition-all duration-300 hover:scale-105 hover:shadow-xl" *ngFor="let card of cards; let i = index" [attr.aria-label]="card.title">
        <fa-icon [icon]="card.icon" class="large-icon text-4xl text-white mb-3 animate-pulse"></fa-icon>
        <h3 class="text-lg font-semibold text-white mb-1">{{ card.title }}</h3>
        <p class="text-2xl font-bold text-white">{{ card.value }}</p>
      </div>
    </ng-container>
  </div>

  <!-- Graphiques -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 mb-8">
    <!-- Courbe historique -->
    <div class="bg-white rounded-xl shadow-lg p-6 transform transition-all duration-300 hover:shadow-xl" *ngIf="isBrowser()" ngSkipHydration>
      <h3 class="text-lg font-semibold mb-4 text-gray-800 text-center">Historique des Commandes</h3>
      <canvas baseChart
        [data]="lineChartData"
        [options]="lineChartOptions"
        [type]="lineChartType"
        class="w-full h-56"></canvas>
      <div class="flex flex-wrap justify-center mt-4 gap-2">
        <button (click)="filterByWeek()" class="px-4 py-2 rounded-lg bg-[#5371FF] text-white hover:bg-[#415ad8] transition-colors duration-200 shadow-md">Semaine</button>
        <button (click)="filterByMonth()" class="px-4 py-2 rounded-lg bg-[#5371FF] text-white hover:bg-[#415ad8] transition-colors duration-200 shadow-md">Mois</button>
        <button (click)="filterByYear()" class="px-4 py-2 rounded-lg bg-[#5371FF] text-white hover:bg-[#415ad8] transition-colors duration-200 shadow-md">Année</button>
      </div>
    </div>

    <!-- Bar chart -->
    <div class="bg-white rounded-xl shadow-lg p-6 transform transition-all duration-300 hover:shadow-xl" *ngIf="isBrowser()" ngSkipHydration>
      <h3 class="text-lg font-semibold mb-4 text-gray-800 text-center">Encaissements Restaurants vs Livreurs</h3>
      <canvas baseChart
        [data]="barChartData"
        [options]="barChartOptions"
        [type]="barChartType"
        class="w-full h-56"></canvas>
    </div>

    <!-- Doughnut chart -->
    <div class="bg-white rounded-xl shadow-lg p-6 transform transition-all duration-300 hover:shadow-xl" *ngIf="isBrowser()" ngSkipHydration>
      <h3 class="text-lg font-semibold mb-4 text-gray-800 text-center">Répartition Utilisateurs</h3>
      <canvas baseChart
        [data]="doughnutChartData"
        [options]="doughnutChartOptions"
        [type]="doughnutChartType"
        class="w-full h-56"></canvas>
    </div>
  </div>

  <!-- Liste des administrateurs -->
  <div class="admin-list bg-white rounded-xl shadow-lg p-8 transform transition-all duration-300 hover:shadow-xl">
    <h3 class="text-xl font-semibold mb-6 text-gray-800 text-center">Liste des Administrateurs</h3>
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
        <thead class="!bg-gradient-to-r !from-[#5371FF] !to-[#415ad8] text-white">
          <tr>
            <th class="px-4 py-3 text-left text-sm font-semibold uppercase">#</th>
            <th class="px-4 py-3 text-left text-sm font-semibold uppercase">Nom</th>
            <th class="px-4 py-3 text-left text-sm font-semibold uppercase">Email</th>
            <th class="px-4 py-3 text-left text-sm font-semibold uppercase">Rôle</th>
            <th class="px-4 py-3 text-left text-sm font-semibold uppercase">Statut</th>
            <th class="px-4 py-3 text-center text-sm font-semibold uppercase">Actions</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          <tr *ngFor="let admin of paginatedAdmins(); let i = index" class="hover:bg-gray-50 transition-colors duration-200">
            <td class="px-4 py-3 text-sm">{{ (currentPage - 1) * itemsPerPage + i + 1 }}</td>
            <td class="px-4 py-3 text-sm font-medium">{{ admin.name }}</td>
            <td class="px-4 py-3 text-sm">{{ admin.email }}</td>
            <td class="px-4 py-3 text-sm">{{ admin.role }}</td>
            <td class="px-4 py-3">
              <span [ngClass]="admin.isActive ? 'bg-green-100 text-green-800 border-green-200' : 'bg-red-100 text-red-800 border-red-200'"
                    class="px-3 py-1 rounded-full text-xs font-semibold border">
                {{ admin.isActive ? 'Actif' : 'Inactif' }}
              </span>
            </td>
            <td class="px-4 py-3 flex gap-3 justify-center">
              <button (click)="editAdmin(admin)" class="text-blue-600 hover:text-blue-800 text-xl transition-colors duration-200" title="Modifier" aria-label="Modifier administrateur">
                <fa-icon [icon]="faEdit" class="w-5 h-5"></fa-icon>
              </button>
              <button (click)="deleteAdmin(admin)" class="text-red-600 hover:text-red-800 text-xl transition-colors duration-200" title="Supprimer" aria-label="Supprimer administrateur">
                <fa-icon [icon]="faTrash" class="w-5 h-5"></fa-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div class="flex flex-col sm:flex-row items-center justify-between mt-6 gap-4" *ngIf="totalPages() > 1">
      <button (click)="prevPage()" [disabled]="currentPage === 1"
        class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 shadow-md flex items-center gap-2">
        <fa-icon [icon]="faChevronLeft" class="w-4 h-4"></fa-icon> Précédent
      </button>
      <div class="flex gap-2">
        <span *ngFor="let page of [].constructor(totalPages()); let i = index"
              (click)="currentPage = i + 1"
              class="px-3 py-2 rounded-lg cursor-pointer transition-colors duration-200"
              [ngClass]="currentPage === i + 1 ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'">
          {{ i + 1 }}
        </span>
      </div>
      <button (click)="nextPage()" [disabled]="currentPage === totalPages()"
        class="px-4 py-2 rounded-lg bg-blue-500 text-white hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors duration-200 shadow-md flex items-center gap-2">
        Suivant <fa-icon [icon]="faChevronRight" class="w-4 h-4"></fa-icon>
      </button>
    </div>
  </div>
</div>
