<app-header></app-header>
<div class="container">
  <app-sidebar></app-sidebar>
  <div class="main-content">
    <button class="btn-add" (click)="openAddLivreurModal()">Ajouter un livreur</button> <!-- Modal d'ajout -->
    <div *ngIf="isAddModalVisible" class="modal">
      <div class="modal-content"> <span class="close" (click)="closeAddModal()">&times;</span>
        <h2>Ajouter un Livreur</h2> <!-- Étape 1 : infos personnelles -->
        <form *ngIf="formStep === 1" (submit)="goToStep2($event)" #addFormStep1="ngForm">
          <div class="form-group"> <label for="name">Nom :</label> <input type="text" id="name" name="name"
              [(ngModel)]="newLivreur.name" required /> </div>
          <div class="form-group"> <label for="email">Email :</label> <input type="email" id="email" name="email"
              [(ngModel)]="newLivreur.email" required /> </div>
          <div class="form-group"> <label for="phone">Téléphone :</label> <input type="text" id="phone" name="phone"
              [(ngModel)]="newLivreur.phone" required /> </div>
          <div class="form-group"> <label for="vehicleType">Type de véhicule :</label> <input type="text"
              id="vehicleType" name="vehicleType" [(ngModel)]="newLivreur.vehicleType" required /> </div>
          <div class="form-group"> <label for="vehicleNumber">Numéro du véhicule :</label> <input type="text"
              id="vehicleNumber" name="vehicleNumber" [(ngModel)]="newLivreur.vehicleNumber" required /> </div> <button
            type="submit" class="btn-submit">Suivant</button>
        </form> <!-- Étape 2 : fichiers + final -->
        <form *ngIf="formStep === 2" (submit)="onAddSubmit()" #addFormStep2="ngForm" enctype="multipart/form-data">
          <div class="form-group"> <label for="idCardCopy">Copie CNI :</label> <input type="file" id="idCardCopy"
              (change)="onFileChange($event, 'idCardCopy')" required /> </div>
          <div class="form-group"> <label for="insuranceCopy">Copie Assurance :</label> <input type="file"
              id="insuranceCopy" (change)="onFileChange($event, 'insuranceCopy')" required /> </div>
          <div class="form-navigation"> <button type="button" class="btn-back" (click)="formStep = 1">Retour</button>
            <button type="submit" class="btn-submit">Ajouter</button>
          </div>
        </form>
      </div>
    </div> <!-- Modal d'édition -->
    <div *ngIf="isEditModalVisible" class="modal">
      <div class="modal-content"> <span class="close" (click)="closeEditModal()">&times;</span>
        <h2>Modifier le Livreur</h2>
        <form *ngIf="selectedLivreur" (submit)="onEditSubmit()" #editForm="ngForm">
          <div class="form-group"> <label for="edit-name">Nom :</label> <input type="text" id="edit-name"
              name="edit-name" [(ngModel)]="selectedLivreur.name" required /> </div>
          <div class="form-group"> <label for="edit-email">Email :</label> <input type="email" id="edit-email"
              name="edit-email" [(ngModel)]="selectedLivreur.email" required readonly /> </div>
          <div class="form-group"> <label for="edit-phone">Téléphone :</label> <input type="text" id="edit-phone"
              name="edit-phone" [(ngModel)]="selectedLivreur.phone" required /> </div>
          <div class="form-group"> <label for="edit-vehicle-type">Type de véhicule :</label> <input type="text"
              id="edit-vehicle-type" name="edit-vehicle-type" [(ngModel)]="selectedLivreur.vehicleType" required />
          </div>
          <div class="form-group"> <label for="edit-vehicle-number">Numéro de véhicule :</label> <input type="text"
              id="edit-vehicle-number" name="edit-vehicle-number" [(ngModel)]="selectedLivreur.vehicleNumber"
              required /> </div>
          <div class="form-group"> <label for="edit-idCardCopy">Remplacer la carte d'identité :</label> <input
              type="file" id="edit-idCardCopy" name="edit-idCardCopy" (change)="onEditFileChange($event, 'idCardCopy')"
              accept="image/*,.pdf" /> </div>
          <div class="form-group"> <label for="edit-insuranceCopy">Remplacer l'assurance :</label> <input type="file"
              id="edit-insuranceCopy" name="edit-insuranceCopy" (change)="onEditFileChange($event, 'insuranceCopy')"
              accept="image/*,.pdf" /> </div> <button type="submit" class="btn-submit">Enregistrer</button>
        </form>
      </div>
    </div> <!-- Modal de confirmation de suppression -->
    <div *ngIf="isDeleteModalVisible" class="modal">
      <div class="modal-content">
        <h2>Confirmation</h2>
        <p>Voulez-vous vraiment supprimer ce livreur ?</p> <button (click)="confirmDelete()"
          class="btn-delete">Supprimer</button> <button (click)="cancelDelete()" class="btn-cancel">Annuler</button>
      </div>
    </div> <!-- Messages globaux -->
    <div *ngIf="successMessage" class="success-message">{{ successMessage }}</div>
    <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div> <!-- Liste des livreurs -->
    <div class="livreurs-list">
      <h2>Liste des Livreurs</h2>
      <table>
        <thead>
          <tr>
            <th>Nom</th>
            <th>Email</th>
            <th>Téléphone</th>
            <th>Véhicule</th>
            <th>Immatriculation</th>
            <th>Carte ID</th>
            <th>Assurance</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let livreur of livreurs">
            <td>{{ livreur.name }}</td>
            <td>{{ livreur.email }}</td>
            <td>{{ livreur.phone }}</td>
            <td>{{ livreur.vehicleType || '-' }}</td>
            <td>{{ livreur.vehicleNumber || '-' }}</td>
            <td> <a *ngIf="livreur.idCardCopy" [href]="getFileUrl(livreur.idCardCopy)" target="_blank">Voir</a> </td>
            <td> <a *ngIf="livreur.insuranceCopy" [href]="getFileUrl(livreur.insuranceCopy)" target="_blank">Voir</a>
            </td>
            <td> <span
                [ngClass]="{ 'badge-approved': livreur.status === 'approved', 'badge-incomplete': livreur.status === 'incomplete', 'badge-rejected': livreur.status === 'rejected', 'badge-pending': livreur.status === 'pending', 'badge-blocked': livreur.status === 'blocked' }">{{
                livreur.status }}</span> </td>
            <td> <button class="icon-button edit" (click)="editLivreur(livreur)" title="Modifier"> <i
                  class="fas fa-edit"></i> </button> <button class="icon-button delete"
                (click)="openDeleteModal(livreur.id)" title="Supprimer"> <i class="fas fa-trash"></i> </button> <button
                class="btn-approve" (click)="approveLivreur(livreur.id)"
                [disabled]="livreur.status === 'approved'">Approuver</button> <button class="btn-reject"
                (click)="rejectLivreur(livreur.id)" [disabled]="livreur.status === 'rejected'">Rejeter</button> </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
